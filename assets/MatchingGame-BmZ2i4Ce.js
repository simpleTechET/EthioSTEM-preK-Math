import{j as e}from"./ui-vendor-D4wbF8Bg.js";import{r as a}from"./react-vendor-X0Zsz5kA.js";import{B as O}from"./button-DEXtpTGH.js";import{C as T}from"./card-C2_wGUG6.js";import{c as V,s as B,u as D}from"./index-B788Y5nr.js";import{S as E}from"./sparkles-DWWWFHLk.js";import{V as R}from"./volume-2-CKAf-jTH.js";import{C as Y}from"./circle-check-DH06BxuO.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=V("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),J=({studentName:m,studentPhoto:l,context:x,type:r,show:f,onClose:j})=>{const[c,u]=a.useState(""),[o,y]=a.useState(!1),[n,h]=a.useState(!1),[w,p]=a.useState(!1),v=a.useRef(null);a.useEffect(()=>(f&&x&&d(),()=>{v.current&&window.speechSynthesis.cancel()}),[f,x,r]);const d=async()=>{y(!0);try{const s=await(await fetch("https://ethio-stem-pre-k-math.vercel.app/api/companion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentName:m,context:x,type:r})})).json();u(s.message),g(s.message)}catch(i){console.error("AI Companion error:",i);const s=`Keep going, ${m}!`;u(s),g(s)}finally{y(!1)}},g=i=>{window.speechSynthesis.cancel();const s=new SpeechSynthesisUtterance(i);v.current=s,s.rate=.9,s.pitch=1.1,s.volume=1,s.onstart=()=>{h(!0),N()},s.onend=()=>{h(!1),b()},s.onerror=()=>{h(!1),b()},window.speechSynthesis.speak(s)},N=()=>{const i=setInterval(()=>{p(s=>!s)},200);window.mouthAnimationInterval=i},b=()=>{window.mouthAnimationInterval&&(clearInterval(window.mouthAnimationInterval),window.mouthAnimationInterval=null),p(!1)},S=()=>{n?(window.speechSynthesis.cancel(),h(!1),b()):g(c)};return f?e.jsx("div",{className:"fixed bottom-6 right-6 z-50 animate-in slide-in-from-bottom-4",children:e.jsx(T,{className:"max-w-sm border-2 border-primary bg-gradient-to-br from-primary/5 to-secondary/5 shadow-xl",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 relative",children:l?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l,alt:m,className:"w-16 h-16 rounded-full object-cover border-2 border-primary"}),n&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 bg-black rounded-full transition-all duration-100",style:{width:w?"12px":"8px",height:w?"8px":"4px"}}),n&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full animate-pulse"})]}):e.jsxs("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center relative",children:[e.jsx(E,{className:"w-8 h-8 text-primary"}),n&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full animate-pulse"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-sm text-primary",children:"Your Study Buddy"}),e.jsx(E,{className:"w-4 h-4 text-primary"})]}),!o&&c&&e.jsx("button",{onClick:S,className:"p-1 hover:bg-primary/10 rounded transition-colors",title:n?"Stop speaking":"Play message",children:n?e.jsx(q,{className:"w-4 h-4 text-primary"}):e.jsx(R,{className:"w-4 h-4 text-primary"})})]}),o?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}):e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:"text-sm text-foreground",children:c}),e.jsx("div",{className:"absolute -left-6 top-2 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-r-8 border-r-card"})]})]}),j&&e.jsx("button",{onClick:()=>{window.speechSynthesis.cancel(),j()},className:"text-muted-foreground hover:text-foreground text-xl leading-none",children:"Ã—"})]})})})}):null},Z=({items:m,onComplete:l,hideCompletionUI:x=!1})=>{const r=a.useMemo(()=>B(m),[m]),{isPremium:f,studentPhoto:j}=D(),[c,u]=a.useState([]),[o,y]=a.useState([]),[n,h]=a.useState(0),[w,p]=a.useState(!1),[v,d]=a.useState(!1),[g,N]=a.useState(""),[b,S]=a.useState("encouragement"),[i]=a.useState(localStorage.getItem("ethiostem-student-name")||"Student"),s=t=>{if(o.includes(t.id)||c.includes(t.id)||w)return;const I=[...c,t.id];if(u(I),I.length===2){p(!0),h(n+1);const[z,$]=I,M=r.find(A=>A.id===z),C=r.find(A=>A.id===$);(M==null?void 0:M.matchId)===(C==null?void 0:C.matchId)?(y([...o,z,$]),N("The student just matched two objects correctly!"),S("celebration"),d(!0),setTimeout(()=>d(!1),5e3),setTimeout(()=>{u([]),p(!1),o.length+2===r.length&&(l==null||l())},800)):(N("The student tried to match objects but they were different. Encourage them to look more carefully at the colors, shapes, and sizes."),S("correction"),d(!0),setTimeout(()=>d(!1),5e3),setTimeout(()=>{u([]),p(!1)},1200))}},P=t=>c.includes(t),k=t=>o.includes(t),L=o.length===r.length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Attempts: ",e.jsx("span",{className:"font-semibold text-foreground",children:n})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Matched: ",e.jsx("span",{className:"font-semibold text-foreground",children:o.length/2})," / ",r.length/2]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:r.map(t=>e.jsxs(T,{onClick:()=>s(t),className:`
              relative aspect-square cursor-pointer transition-all duration-300
              ${k(t.id)?"opacity-50 border-success border-4":""}
              ${P(t.id)?"border-primary border-4 scale-105":""}
              ${!k(t.id)&&!P(t.id)?"hover:scale-105 hover:shadow-playful":""}
            `,children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsx("img",{src:t.image,alt:"Match item",className:`object-contain transition-all ${t.size==="large"?"w-36 h-36":t.size==="small"?"w-20 h-20":"w-full h-full"}`})}),k(t.id)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(Y,{className:"w-8 h-8 text-success fill-success/20"})})]},t.id))}),L&&!x&&e.jsxs(T,{className:"p-8 text-center bg-gradient-to-br from-success/10 to-primary/10 border-2 border-success",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-2xl font-bold mb-2 text-foreground",children:"Amazing Job!"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["You matched all the objects! You completed it in ",n," attempts."]}),e.jsx(O,{size:"lg",onClick:l,className:"shadow-playful",children:"Continue Learning"})]}),f&&e.jsx(J,{studentName:i,studentPhoto:j||void 0,context:g,type:b,show:v,onClose:()=>d(!1)})]})};export{Z as M};
