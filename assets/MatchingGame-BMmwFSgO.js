import{j as e}from"./ui-vendor-C-ksHByf.js";import{r as a}from"./react-vendor-X0Zsz5kA.js";import{C as T,B as E}from"./card-CWpPAmAQ.js";import{c as $,s as O,u as V}from"./index-Bii1jnHg.js";import{S as L}from"./sparkles-zISB7p15.js";import{C as B}from"./circle-check-B1BauISk.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=$("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=$("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Y=({studentName:m,studentPhoto:c,context:n,type:y,show:b,onClose:u})=>{const[d,r]=a.useState(""),[j,h]=a.useState(!1),[o,p]=a.useState(!1),[x,w]=a.useState(!1),i=a.useRef(null);a.useEffect(()=>(b&&n&&v(),()=>{i.current&&window.speechSynthesis.cancel()}),[b,n,y]);const v=async()=>{h(!0);try{const s=await(await fetch("https://ethio-stem-pre-k-math.vercel.app/api/companion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentName:m,context:n,type:y})})).json();r(s.message),f(s.message)}catch(l){console.error("AI Companion error:",l);const s=`Keep going, ${m}!`;r(s),f(s)}finally{h(!1)}},f=l=>{window.speechSynthesis.cancel();const s=new SpeechSynthesisUtterance(l);i.current=s,s.rate=.9,s.pitch=1.1,s.volume=1,s.onstart=()=>{p(!0),N()},s.onend=()=>{p(!1),g()},s.onerror=()=>{p(!1),g()},window.speechSynthesis.speak(s)},N=()=>{const l=setInterval(()=>{w(s=>!s)},200);window.mouthAnimationInterval=l},g=()=>{window.mouthAnimationInterval&&(clearInterval(window.mouthAnimationInterval),window.mouthAnimationInterval=null),w(!1)},S=()=>{o?(window.speechSynthesis.cancel(),p(!1),g()):f(d)};return b?e.jsx("div",{className:"fixed bottom-6 right-6 z-50 animate-in slide-in-from-bottom-4",children:e.jsx(T,{className:"max-w-sm border-2 border-primary bg-gradient-to-br from-primary/5 to-secondary/5 shadow-xl",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 relative",children:c?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:c,alt:m,className:"w-16 h-16 rounded-full object-cover border-2 border-primary"}),o&&e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 bg-black rounded-full transition-all duration-100",style:{width:x?"12px":"8px",height:x?"8px":"4px"}}),o&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full animate-pulse"})]}):e.jsxs("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center relative",children:[e.jsx(L,{className:"w-8 h-8 text-primary"}),o&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full animate-pulse"})]})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-sm text-primary",children:"Your Study Buddy"}),e.jsx(L,{className:"w-4 h-4 text-primary"})]}),!j&&d&&e.jsx("button",{onClick:S,className:"p-1 hover:bg-primary/10 rounded transition-colors",title:o?"Stop speaking":"Play message",children:o?e.jsx(R,{className:"w-4 h-4 text-primary"}):e.jsx(D,{className:"w-4 h-4 text-primary"})})]}),j?e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}):e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:"text-sm text-foreground",children:d}),e.jsx("div",{className:"absolute -left-6 top-2 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-r-8 border-r-card"})]})]}),u&&e.jsx("button",{onClick:()=>{window.speechSynthesis.cancel(),u()},className:"text-muted-foreground hover:text-foreground text-xl leading-none",children:"Ã—"})]})})})}):null},F=({items:m,onComplete:c})=>{const n=a.useMemo(()=>O(m),[m]),{isPremium:y,studentPhoto:b}=V(),[u,d]=a.useState([]),[r,j]=a.useState([]),[h,o]=a.useState(0),[p,x]=a.useState(!1),[w,i]=a.useState(!1),[v,f]=a.useState(""),[N,g]=a.useState("encouragement"),[S]=a.useState(localStorage.getItem("ethiostem-student-name")||"Student"),l=t=>{if(r.includes(t.id)||u.includes(t.id)||p)return;const M=[...u,t.id];if(d(M),M.length===2){x(!0),o(h+1);const[z,P]=M,I=n.find(C=>C.id===z),A=n.find(C=>C.id===P);(I==null?void 0:I.matchId)===(A==null?void 0:A.matchId)?(j([...r,z,P]),f("The student just matched two objects correctly!"),g("celebration"),i(!0),setTimeout(()=>i(!1),5e3),setTimeout(()=>{d([]),x(!1),r.length+2===n.length&&(c==null||c())},800)):(f("The student tried to match objects but they were different. Encourage them to look more carefully at the colors, shapes, and sizes."),g("correction"),i(!0),setTimeout(()=>i(!1),5e3),setTimeout(()=>{d([]),x(!1)},1200))}},s=t=>u.includes(t),k=t=>r.includes(t),q=r.length===n.length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Attempts: ",e.jsx("span",{className:"font-semibold text-foreground",children:h})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Matched: ",e.jsx("span",{className:"font-semibold text-foreground",children:r.length/2})," / ",n.length/2]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:n.map(t=>e.jsxs(T,{onClick:()=>l(t),className:`
              relative aspect-square cursor-pointer transition-all duration-300
              ${k(t.id)?"opacity-50 border-success border-4":""}
              ${s(t.id)?"border-primary border-4 scale-105":""}
              ${!k(t.id)&&!s(t.id)?"hover:scale-105 hover:shadow-playful":""}
            `,children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsx("img",{src:t.image,alt:"Match item",className:`object-contain transition-all ${t.size==="large"?"w-36 h-36":t.size==="small"?"w-20 h-20":"w-full h-full"}`})}),k(t.id)&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(B,{className:"w-8 h-8 text-success fill-success/20"})})]},t.id))}),q&&e.jsxs(T,{className:"p-8 text-center bg-gradient-to-br from-success/10 to-primary/10 border-2 border-success",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-2xl font-bold mb-2 text-foreground",children:"Amazing Job!"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["You matched all the objects! You completed it in ",h," attempts."]}),e.jsx(E,{size:"lg",onClick:c,className:"shadow-playful",children:"Continue Learning"})]}),y&&e.jsx(Y,{studentName:S,studentPhoto:b||void 0,context:v,type:N,show:w,onClose:()=>i(!1)})]})};export{F as M};
